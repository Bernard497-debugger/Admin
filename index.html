<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Khali Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; margin:20px; background:#f4f6fa; }
    h1 { color:#333; }
    form { background:#fff; padding:16px; border-radius:8px; margin-bottom:24px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    label { display:block; margin-top:8px; }
    input, textarea { width:100%; padding:8px; margin-top:4px; border:1px solid #ccc; border-radius:4px; }
    button { margin-top:12px; padding:8px 12px; border:none; border-radius:4px; background:#2196f3; color:#fff; cursor:pointer; }
    button:hover { background:#1976d2; }
    table { width:100%; border-collapse:collapse; margin-top:16px; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    th, td { padding:12px; border-bottom:1px solid #eee; text-align:left; }
    th { background:#f0f0f0; }
    .delete-btn { background:#f44336; color:#fff; border:none; padding:6px 10px; border-radius:4px; cursor:pointer; }
    .delete-btn:hover { background:#c62828; }
  </style>
</head>
<body>
  <h1>⚙️ Khali Admin Panel</h1>

  <form id="appForm" enctype="multipart/form-data">
    <h3>Add New App</h3>
    <label>Name <input type="text" name="name" required></label>
    <label>Description <textarea name="desc" required></textarea></label>
    <label>App File <input type="file" name="file" required></label>
    <button type="submit">Upload App</button>
  </form>

  <h3>Existing Apps</h3>
  <table>
    <thead>
      <tr><th>ID</th><th>Name</th><th>Description</th><th>File</th><th>Action</th></tr>
    </thead>
    <tbody id="appsTable"></tbody>
  </table>

  <script>
    const API_URL = "https://YOUR-BACKEND-URL.onrender.com"; // change after deployment

    async function loadApps() {
      const res = await fetch(API_URL + "/apps");
      const apps = await res.json();
      const table = document.getElementById("appsTable");
      table.innerHTML = "";
      apps.forEach(app => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${app.id}</td>
          <td>${app.name}</td>
          <td>${app.desc}</td>
          <td><a href="${API_URL}/download/${app.id}" target="_blank">${app.filename}</a></td>
          <td><button class="delete-btn" onclick="deleteApp(${app.id})">Delete</button></td>
        `;
        table.appendChild(row);
      });
    }

    async function deleteApp(id) {
      if(confirm("Delete this app?")) {
        await fetch(API_URL + "/apps/" + id, { method:"DELETE" });
        loadApps();
      }
    }

    document.getElementById("appForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      await fetch(API_URL + "/apps", {
        method:"POST",
        body: formData
      });
      e.target.reset();
      loadApps();
    });

    loadApps();
  </script>
</body>
</html>
